function Event(){this.listeners=[]}function DropdownController(o,n){this.DropdownView=o,this.DropdownModel=n,this.init(),this.DropdownView.setPlaceholder(this.DropdownModel.updatePlaceholder())}function DropdownView(o){this.$container=o,this.$dropdown=void 0,this.onReducing=new Event,this.onIncreasing=new Event,this.onClosingAndOpening=new Event,this.onClearing=new Event;var n=$('<div style="height: 44px;"></div>');o.append(n),this.pos=n.position()}function DropdownModel(o){this.params=o,this.valuePattern=o.valuePattern?o.valuePattern:"T",this.specClass=o.specClass?o.specClass:"",this.placeholder=o.placeholder?o.placeholder:"Parameters",this.placeholderSpelling=o.placeholderSpelling?o.placeholderSpelling:function(){},this.dataSize=o.dataSize?o.dataSize:"short",this.options=o.options?o.options:[],this.clearBtn=null!=o.clearBtn&&o.clearBtn,this.applyBtn=null!=o.applyBtn&&o.applyBtn,this.minAmount=0;for(var n=0;n<this.options.length;n++)null!=this.options[n].value?this.minAmount+=this.options[n].value:this.options[n].value=0,null==this.options[n].min&&(this.options[n].min=0),null==this.options[n].max&&(this.options[n].max=-1);this.amount=this.minAmount}!function(o){o.fn.dropdown=function(n={}){for(var t=0;t<this.length;t++){var e=new DropdownModel(n),i=new DropdownView(o(this[t]));this.controller=new DropdownController(i,e)}}}(jQuery),Event.prototype.add=function(o){this.listeners.push(o)},Event.prototype.manage=function(o={}){for(var n=0;n<this.listeners.length;n++)return this.listeners[n](o)},DropdownController.prototype.init=function(){this.DropdownView.createDropdown(this.DropdownModel.getParamData());var o=this;this.DropdownView.onReducing.add(function(n){o.reduceValue(n)}),this.DropdownView.onIncreasing.add(function(n){o.increaseValue(n)}),this.DropdownView.onClosingAndOpening.add(function(){o.closeAndOpen()}),this.DropdownView.onClearing.add(function(){o.clear()})},DropdownController.prototype.reduceValue=function(o){this.DropdownModel.amount--;var n=parseInt(o.parentNode.getAttribute("data-index"));this.DropdownModel.options[n].value--;var t=this.DropdownModel.options[n].value;o.parentNode.children[1].innerHTML=t,t==this.DropdownModel.options[n].min&&o.classList.add("disabled"),o.parentNode.children[2].classList.remove("disabled"),this.DropdownView.setPlaceholder(this.DropdownModel.updatePlaceholder())},DropdownController.prototype.increaseValue=function(o){this.DropdownModel.amount++;var n=parseInt(o.parentNode.getAttribute("data-index"));this.DropdownModel.options[n].value++;var t=this.DropdownModel.options[n].value;o.parentNode.children[1].innerHTML=t,t==this.DropdownModel.options[n].max&&o.classList.add("disabled"),o.parentNode.children[0].classList.remove("disabled"),this.DropdownView.setPlaceholder(this.DropdownModel.updatePlaceholder())},DropdownController.prototype.closeAndOpen=function(){this.DropdownView.$dropdown.toggleClass("default"),this.DropdownView.$dropdown.toggleClass("extended")},DropdownController.prototype.clear=function(){this.DropdownView.$dropdown.find(".dropdown-input").val(this.DropdownModel.placeholder),this.DropdownView.$dropdown.find(".option-less").removeClass("disabled").addClass("disabled"),this.DropdownView.$dropdown.find(".option-more").removeClass("disabled");for(var o=this.DropdownView.$dropdown.find(".option-amount"),n=0;n<o.length;n++)o[n].innerHTML=this.DropdownModel.options[n].min,this.DropdownModel.options[n].value=this.DropdownModel.options[n].min;this.DropdownModel.amount=this.DropdownModel.minAmount},DropdownView.prototype.createDropdown=function(o){var n='<div style="left: '+this.pos.left+"px; top: "+this.pos.top+'px;" class="';if(null!=o.specClass&&(n+=o.specClass+"-dropdown "),n+='dropdown default"><div class="dropdown-head"><div class="expand arrow-after"></div><input readonly="readonly" type="text" name="',null!=o.specClass?n+=o.specClass:n+="dropdown",n+='" class="dropdown-input search-param-input search-',null!=o.specClass&&(n+=o.specClass),n+='" data-size="',null!=o.dataSize?n+=o.dataSize:n+="short",n+='" value="',null!=o.placeholder&&(n+=o.placeholder),n+='"/></div><div class="dropdown-body">',null!=o.options)for(var t=0;t<o.options.length;t++)n+='<div class="dropdown-option"><div class="option-title">'+o.options[t].title+'</div><div class="option-buttons" data-index="'+t+'"><div class="option-less option-btn disabled">-</div><div class="option-amount">',null!=o.options[t].value?n+=o.options[t].value:n+="0",n+='</div><div class="option-more option-btn">+</div></div></div>';null==o.clearBtn&&null==o.applyBtn||(n+='<div class="dropdown-confirm dropdown-option">',null!=o.clearBtn&&o.clearBtn&&(n+='<div class="dropdown-clear hidden">Очистить</div>'),null!=o.applyBtn&&o.applyBtn&&(n+='<div class="dropdown-apply">Применить</div>'),n+="</div>"),n+="</div></div>",this.$dropdown=$(n),this.$container.append(this.$dropdown),this.addListeners()},DropdownView.prototype.addListeners=function(){var o=this;document.addEventListener("click",function(n){for(var t=$(".dropdown"),e=0;e<t.length;e++)0==$(t[e]).find(n.target).length&&o.onClosingAndOpening.manage()}),this.$dropdown.children().eq(0).click(function(){o.onClosingAndOpening.manage()}),this.$dropdown.children().eq(1).click(function(n){if(o.$dropdown.find(".dropdown-apply")[0]!=n.target)if(o.$dropdown.find(".dropdown-clear")[0]!=n.target){if(!$(n.target).hasClass("disabled"))for(var t=o.$dropdown.find(".option-less"),e=o.$dropdown.find(".option-more"),i=0;i<t.length;i++)n.target==t[i]?o.onReducing.manage(n.target):n.target==e[i]&&o.onIncreasing.manage(n.target)}else o.onClearing.manage();else o.onClosingAndOpening.manage()})},DropdownView.prototype.setPlaceholder=function(o){this.$dropdown.find(".dropdown-input").val(o)},DropdownModel.prototype.getParamData=function(){return this.params},DropdownModel.prototype.updatePlaceholder=function(){if(0==this.amount)return this.placeholder;if("T"==this.valuePattern)return this.amount+" "+this.placeholderSpelling(this.amount);if("S"==this.valuePattern){for(var o="",n=0;n<this.options.length;n++)o+=this.options[n].value+" "+this.placeholderSpelling(n,this.options[n].value),n+1<this.options.length&&(o+=", ");return o}};